# SMS 알림 서비스 설정 가이드

## 📱 개요

상담문의 및 특강신청 접수 시 관리자에게 즉시 SMS 알림을 보내기 위한 설정 가이드입니다.

**추천 서비스: 알리고 (Aligo)** ⭐

## 🚀 빠른 시작 가이드

### 1단계: 알리고 계정 생성 (약 30분)

1. **알리고 회원가입**
   - [알리고 사이트](https://smartsms.aligo.in/) 접속
   - 회원가입 진행
   - 본인인증 완료 (휴대폰 인증)

2. **무료 충전 확인**
   - 신규 가입 시 무료 충전 제공
   - 관리자 페이지에서 잔액 확인

3. **발신번호 등록** (선택사항)
   - 관리자 페이지 → 발신번호 관리
   - 사용할 전화번호 등록 (080 번호 사용 가능)

### 2단계: API 키 발급 (약 10분)

1. **알리고 관리자 페이지 접속**
   - 로그인 후 대시보드

2. **API 인증키 확인**
   - 좌측 메뉴 → **"API"** → **"인증키"**
   - **"API Key"** 복사 (예: `abc123def456...`)
   - **"User ID"** 확인 (예: `your_user_id`)

3. **발신번호 확인**
   - 발신번호가 등록되어 있으면 해당 번호 사용
   - 미등록 시 빈 문자열 또는 080 번호 사용

### 3단계: 환경 변수 설정

#### Vercel 환경 변수 설정 (프로덕션)

1. **Vercel 대시보드 접속**
   - [https://vercel.com](https://vercel.com) → 프로젝트 선택

2. **환경 변수 추가**
   - **Settings** → **Environment Variables** → **"Add New"**
   
   다음 변수들을 추가:

   | Key | Value | 설명 |
   |-----|-------|------|
   | `SMS_API_KEY` | 알리고 API Key | 알리고 관리자 페이지에서 복사한 API Key |
   | `SMS_USER_ID` | 알리고 User ID | 알리고 사용자 ID |
   | `SMS_SENDER` | 발신번호 (선택) | 등록된 발신번호 또는 빈 문자열 |
   | `ADMIN_PHONE` | 관리자 전화번호 | SMS 수신할 관리자 전화번호 (예: `010-1234-5678`) |

   **예시:**
   ```
   SMS_API_KEY=abc123def456ghi789...
   SMS_USER_ID=your_user_id
   SMS_SENDER=01012345678
   ADMIN_PHONE=010-1234-5678
   ```

3. **재배포** (필수)
   - 환경 변수 추가 후 반드시 재배포 필요
   - **Deployments** → 최신 배포의 **"Redeploy"**

#### 로컬 개발 환경 (.env.local)

프로젝트 루트의 `.env.local` 파일에 추가:

```env
# 알리고 SMS 서비스 설정
SMS_API_KEY=your_api_key_here
SMS_USER_ID=your_user_id
SMS_SENDER=01012345678  # 선택사항: 등록된 발신번호
ADMIN_PHONE=010-1234-5678  # 관리자 전화번호
```

개발 서버 재시작:
```bash
npm run dev
```

### 4단계: 테스트 (약 30분)

1. **상담문의 테스트**
   - 웹사이트에서 상담문의 폼 제출
   - 관리자 전화번호로 SMS 수신 확인
   - Vercel 로그 확인:
     ```
     📱 SMS 전송 성공: { to: '01012345678', messageId: '...' }
     ```

2. **특강신청 테스트**
   - 특강신청 폼 제출
   - 관리자 전화번호로 SMS 수신 확인

3. **에러 확인**
   - SMS가 수신되지 않으면 Vercel 로그 확인
   - 에러 메시지 확인 및 문제 해결

## 📋 환경 변수 설명

### 필수 환경 변수

| 변수명 | 설명 | 예시 |
|--------|------|------|
| `SMS_API_KEY` | 알리고 API 인증키 | `abc123def456...` |
| `SMS_USER_ID` | 알리고 사용자 ID | `your_user_id` |
| `ADMIN_PHONE` | 관리자 전화번호 (SMS 수신) | `010-1234-5678` |

### 선택 환경 변수

| 변수명 | 설명 | 예시 | 기본값 |
|--------|------|------|--------|
| `SMS_SENDER` | 발신번호 (알리고에 등록된 번호) | `01012345678` | 빈 문자열 (등록된 발신번호 사용) |

## 🔍 확인 방법

### 1. API 응답 확인

상담문의 또는 특강신청 제출 시 응답:

```json
{
  "success": true,
  "smsSent": true,
  "message": "상담 문의가 접수되었습니다. 관리자에게 SMS 알림이 전송되었습니다."
}
```

### 2. Vercel 로그 확인

**Deployments** → **Functions** 탭:

- 성공: `📱 SMS 전송 성공: { to: '01012345678', messageId: '...' }`
- 실패: `📱 SMS 전송 실패: { error: '...', code: '...' }`
- 설정 안됨: `📱 SMS 서비스가 설정되지 않았습니다.`

### 3. 실제 SMS 수신 확인

- 관리자 전화번호로 SMS 수신
- 메시지 내용 확인

## ⚠️ 중요 사항

### 환경 변수가 설정되지 않은 경우

- SMS 전송은 **시뮬레이션 모드**로 동작
- 콘솔에 로그만 출력되고 실제 SMS는 발송되지 않음
- 상담문의/특강신청은 정상적으로 접수됨

### SMS 발송 실패 시

- SMS 발송이 실패해도 상담문의/특강신청은 정상적으로 접수됨
- 이메일 알림은 정상적으로 발송됨
- 에러는 로그에 기록됨

### 비용 관리

- 알리고 SMS 가격: **약 20원/건**
- 예상 월 비용:
  - 상담문의 100건/월: 약 2,000원
  - 특강신청 50건/월: 약 1,000원
  - **총 약 3,000원/월**

### 개발/프로덕션 환경

- `NODE_ENV=production`이 아닌 경우: `testmode_yn=Y` (테스트 모드)
- 프로덕션 환경에서만 실제 SMS 발송

## 🐛 문제 해결

### SMS가 발송되지 않는 경우

1. **환경 변수 확인**
   - Vercel 대시보드에서 환경 변수 설정 확인
   - 변수 이름 오타 확인 (대소문자 구분)
   - 재배포 완료 확인

2. **알리고 계정 확인**
   - API Key 및 User ID 확인
   - 계정 잔액 확인 (무료 충전 소진 여부)
   - 발신번호 등록 상태 확인

3. **전화번호 형식 확인**
   - `ADMIN_PHONE` 형식 확인 (예: `010-1234-5678` 또는 `01012345678`)
   - 하이픈 포함 여부 무관 (자동 변환됨)

4. **로그 확인**
   - Vercel Functions 로그에서 에러 메시지 확인
   - 알리고 API 에러 코드 확인:
     - `result_code: 1` = 성공
     - 기타 코드 = 실패 (에러 메시지 확인)

### 알리고 API 에러 코드

| 코드 | 설명 | 해결 방법 |
|------|------|----------|
| 1 | 성공 | - |
| -100 | 필수 파라미터 누락 | 환경 변수 확인 |
| -101 | API Key 오류 | API Key 재확인 |
| -102 | User ID 오류 | User ID 재확인 |
| -200 | 잔액 부족 | 알리고 계정 충전 |
| -300 | 발신번호 미등록 | 발신번호 등록 또는 SMS_SENDER 빈 문자열 |

## 📚 관련 문서

- [SMS 서비스 비교](./SMS_SERVICE_COMPARISON.md) - 다양한 SMS 서비스 비교
- [알리고 개발자 센터](https://smartsms.aligo.in/) - 공식 API 문서

## ✅ 체크리스트

설정 완료 후 확인 사항:

- [ ] 알리고 계정 생성 완료
- [ ] API Key 및 User ID 확인
- [ ] Vercel 환경 변수 설정 완료
- [ ] 재배포 완료
- [ ] 테스트 상담문의 제출
- [ ] 관리자 전화번호로 SMS 수신 확인
- [ ] Vercel 로그에서 "SMS 전송 성공" 메시지 확인
- [ ] 특강신청도 테스트 완료




