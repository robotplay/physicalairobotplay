# 이메일 발송 설정 가이드

## 개요

상담문의 및 특강신청 등록 시 자동으로 확인 이메일이 발송됩니다.

## 환경 변수 설정

Vercel 대시보드에서 다음 환경 변수를 설정해주세요:

### 필수 환경 변수

```
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM=your-email@gmail.com
SMTP_FROM_NAME=피지컬 AI 교육
```

### 환경 변수 설명

- **SMTP_HOST**: SMTP 서버 주소
  - Gmail: `smtp.gmail.com`
  - Outlook: `smtp-mail.outlook.com`
  - 네이버: `smtp.naver.com`
  - 기타: 제공업체에서 안내하는 SMTP 서버 주소

- **SMTP_PORT**: SMTP 포트 번호
  - 일반: `587` (TLS)
  - SSL: `465` (SSL)

- **SMTP_USER**: 이메일 계정 (발신자 이메일)
  - 예: `your-email@gmail.com`

- **SMTP_PASSWORD**: 이메일 계정 비밀번호 또는 앱 비밀번호
  - Gmail: [앱 비밀번호](https://myaccount.google.com/apppasswords) 사용 권장
  - 일반 비밀번호도 가능하지만 보안상 앱 비밀번호 권장

- **SMTP_FROM**: 발신자 이메일 주소 (선택사항)
  - 설정하지 않으면 `SMTP_USER` 사용

- **SMTP_FROM_NAME**: 발신자 이름 (선택사항)
  - 기본값: `피지컬 AI 교육`

## Gmail 설정 방법

Gmail을 사용하여 이메일을 발송하려면 다음 단계를 따르세요.

### 1. Gmail 2단계 인증 활성화

앱 비밀번호를 생성하려면 먼저 2단계 인증이 활성화되어 있어야 합니다.

#### 1.1. Google 계정 설정 접속

1. 웹 브라우저에서 [Google 계정 설정](https://myaccount.google.com/) 접속
2. Google 계정으로 로그인

#### 1.2. 보안 메뉴로 이동

1. 왼쪽 사이드바에서 **"보안"** 클릭
2. 또는 직접 [보안 페이지](https://myaccount.google.com/security) 접속

#### 1.3. 2단계 인증 활성화

1. "Google에 로그인" 섹션에서 **"2단계 인증"** 클릭
2. **"시작하기"** 버튼 클릭
3. 비밀번호 입력 후 다음 단계 진행
4. 전화번호 인증 방법 선택 (문자 메시지 또는 전화 통화)
5. 받은 인증 코드 입력
6. **"사용 설정"** 클릭하여 2단계 인증 활성화 완료

**참고:** 2단계 인증이 이미 활성화되어 있다면 이 단계를 건너뛰고 다음 단계로 진행하세요.

### 2. 앱 비밀번호 생성

일반 비밀번호 대신 앱 비밀번호를 사용하면 보안이 강화됩니다.

#### 2.1. 앱 비밀번호 페이지 접속

1. [앱 비밀번호 페이지](https://myaccount.google.com/apppasswords) 직접 접속
2. 또는 Google 계정 설정 → 보안 → 2단계 인증 → "앱 비밀번호" 메뉴 선택

#### 2.2. 앱 비밀번호 생성

1. **"앱 선택"** 드롭다운에서 **"메일"** 선택
2. **"기기 선택"** 드롭다운에서 **"기타(맞춤 이름)"** 선택
3. 표시되는 텍스트 상자에 **"피지컬 AI 교육"** 또는 원하는 이름 입력
4. **"생성"** 버튼 클릭

#### 2.3. 비밀번호 복사

1. 생성된 **16자리 비밀번호** 확인 (예: `abcd efgh ijkl mnop` 형식)
2. **"복사"** 버튼 클릭하거나 전체 비밀번호를 선택하여 복사
3. **중요:** 이 비밀번호는 다시 확인할 수 없으므로 안전한 곳에 임시로 저장해두세요
4. **"완료"** 버튼 클릭

**앱 비밀번호 형식:**
- 16자리 영문자와 숫자 조합
- 공백이 포함되어 있어도 됩니다 (환경 변수 설정 시 공백 제거 가능)
- 예: `abcd efgh ijkl mnop` → 환경 변수 입력 시 `abcdefghijklmnop` 또는 `abcd efgh ijkl mnop` 둘 다 가능

### 3. Vercel 환경 변수 설정

생성한 앱 비밀번호를 Vercel 환경 변수에 설정합니다.

#### 3.1. Vercel 대시보드 접속

1. [Vercel 대시보드](https://vercel.com/dashboard) 접속
2. 프로젝트 선택
3. **Settings** → **Environment Variables** 메뉴 선택

#### 3.2. 환경 변수 추가

다음 환경 변수들을 추가하세요:

| 변수명 | 값 | 예시 |
|--------|-----|------|
| `SMTP_HOST` | `smtp.gmail.com` | `smtp.gmail.com` |
| `SMTP_PORT` | `587` | `587` |
| `SMTP_USER` | Gmail 주소 | `your-email@gmail.com` |
| `SMTP_PASSWORD` | 앱 비밀번호 | `abcdefghijklmnop` |
| `SMTP_FROM` | 발신자 이메일 | `your-email@gmail.com` |
| `SMTP_FROM_NAME` | 발신자 이름 | `피지컬 AI 교육` |

**환경 변수 입력 예시:**

```
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=abcdefghijklmnop
SMTP_FROM=your-email@gmail.com
SMTP_FROM_NAME=피지컬 AI 교육
```

#### 3.3. 환경 선택

각 환경 변수를 추가할 때 다음 환경에 체크:
- ✅ **Production** (프로덕션)
- ✅ **Preview** (프리뷰, 선택사항)
- ✅ **Development** (개발, 로컬 개발 시 필요)

#### 3.4. 배포 재시작

1. 환경 변수 추가 후 **"Save"** 클릭
2. Vercel이 자동으로 재배포를 시작합니다
3. 배포가 완료될 때까지 기다립니다 (약 1-2분)

### 4. 설정 확인

#### 4.1. 환경 변수 확인

Vercel 대시보드에서 모든 환경 변수가 올바르게 설정되었는지 확인:
- 변수명이 정확한지 확인 (대소문자 구분)
- 값이 올바르게 입력되었는지 확인 (특히 앱 비밀번호)

#### 4.2. 실제 테스트

1. 웹사이트에서 상담문의 폼 작성
2. 이메일 주소 입력
3. 제출 후 이메일 수신 확인
4. 받은편지함과 스팸함 모두 확인

### 5. Gmail 설정 주의사항

#### 5.1. 앱 비밀번호 관련

- ⚠️ **일반 비밀번호 사용 불가**: 2단계 인증이 활성화된 경우 일반 비밀번호로는 로그인할 수 없습니다. 반드시 앱 비밀번호를 사용해야 합니다.
- ⚠️ **비밀번호 재확인 불가**: 앱 비밀번호는 생성 후 다시 확인할 수 없습니다. 잊어버린 경우 새로운 앱 비밀번호를 생성해야 합니다.

#### 5.2. 일일 발송 제한

- Gmail은 개인 계정의 경우 **하루에 약 500통**의 이메일 발송 제한이 있습니다.
- 이 제한을 초과하면 일시적으로 차단될 수 있습니다.
- 대량 발송이 필요한 경우 SendGrid, AWS SES 등 전문 이메일 서비스 사용을 고려하세요.

#### 5.3. 보안 경고

- Google 계정에 보안 경고 이메일이 올 수 있습니다. 이는 정상적인 동작입니다.
- "새 기기에서 Google에 로그인 시도"와 같은 경고는 무시해도 됩니다.
- 필요시 "이것은 제가 시도한 작업입니다"로 표시하여 경고를 해제할 수 있습니다.

## 네이버 메일 설정 방법

### 1. 네이버 메일 설정

```
SMTP_HOST=smtp.naver.com
SMTP_PORT=587
SMTP_USER=your-email@naver.com
SMTP_PASSWORD=네이버-비밀번호
SMTP_FROM=your-email@naver.com
SMTP_FROM_NAME=피지컬 AI 교육
```

**참고:** 네이버는 SMTP 사용을 위해 별도 설정이 필요할 수 있습니다.

## Outlook/Hotmail 설정 방법

```
SMTP_HOST=smtp-mail.outlook.com
SMTP_PORT=587
SMTP_USER=your-email@outlook.com
SMTP_PASSWORD=Outlook-비밀번호
SMTP_FROM=your-email@outlook.com
SMTP_FROM_NAME=피지컬 AI 교육
```

## 기타 SMTP 서비스

### SendGrid

```
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USER=apikey
SMTP_PASSWORD=SendGrid-API-Key
SMTP_FROM=your-email@yourdomain.com
SMTP_FROM_NAME=피지컬 AI 교육
```

### AWS SES

```
SMTP_HOST=email-smtp.region.amazonaws.com
SMTP_PORT=587
SMTP_USER=AWS-SMTP-Username
SMTP_PASSWORD=AWS-SMTP-Password
SMTP_FROM=your-email@yourdomain.com
SMTP_FROM_NAME=피지컬 AI 교육
```

## 테스트 방법

### 1. 환경 변수 설정 확인

Vercel 대시보드에서 모든 환경 변수가 설정되었는지 확인하세요.

### 2. 배포 재시작

환경 변수를 추가한 후 배포가 자동으로 재시작됩니다.

### 3. 실제 테스트

1. **상담문의 테스트**
   - 웹사이트에서 상담문의 폼 작성
   - 이메일 주소 입력
   - 제출 후 이메일 수신 확인

2. **특강신청 테스트**
   - 특강신청 폼 작성
   - 이메일 주소 입력
   - 제출 후 이메일 수신 확인

## 이메일 발송 로직

### 상담문의

- **발송 조건**: 이메일 주소가 입력된 경우에만 발송
- **발송 시점**: 상담문의 제출 직후
- **이메일 내용**: 접수 확인 및 접수 정보

### 특강신청

- **발송 조건**: 이메일 주소가 입력된 경우에만 발송
- **발송 시점**: 신청서 제출 직후
- **이메일 내용**: 신청 접수 확인 및 신청 정보, 다음 단계 안내

## 문제 해결

### 이메일이 발송되지 않는 경우

1. **환경 변수 확인**
   - Vercel 대시보드에서 모든 환경 변수가 설정되었는지 확인
   - Production 환경에 체크되어 있는지 확인

2. **SMTP 설정 확인**
   - SMTP 서버 주소가 정확한지 확인
   - 포트 번호가 정확한지 확인
   - 사용자 이름과 비밀번호가 정확한지 확인

3. **로그 확인**
   - Vercel 배포 로그 확인
   - 서버 로그에서 이메일 발송 관련 에러 확인

4. **시뮬레이션 모드**
   - 환경 변수가 설정되지 않으면 시뮬레이션 모드로 동작
   - 콘솔에 이메일 내용이 출력됨
   - 실제 이메일은 발송되지 않음

### Gmail 앱 비밀번호 오류

#### 문제: "Invalid login" 또는 "Authentication failed" 에러

**해결 방법:**

1. **2단계 인증 확인**
   - [Google 계정 보안](https://myaccount.google.com/security) 페이지 접속
   - "2단계 인증"이 **"켜짐"** 상태인지 확인
   - 꺼져있다면 위의 "1. Gmail 2단계 인증 활성화" 섹션 참고

2. **앱 비밀번호 확인**
   - 앱 비밀번호가 정확히 복사되었는지 확인
   - 공백이 포함되어 있어도 되지만, 환경 변수에 공백 없이 입력하는 것을 권장
   - 앱 비밀번호는 16자리 (4자리씩 4그룹) 형식
   - 예: `abcd efgh ijkl mnop` → `abcdefghijklmnop`로 입력 권장

3. **새 앱 비밀번호 생성**
   - 기존 앱 비밀번호를 잊어버렸거나 오류가 발생하는 경우
   - [앱 비밀번호 페이지](https://myaccount.google.com/apppasswords)에서 새로 생성
   - 이전 앱 비밀번호는 자동으로 비활성화됨

4. **환경 변수 재설정**
   - Vercel 대시보드에서 `SMTP_PASSWORD` 환경 변수 삭제 후 재추가
   - 새로 생성한 앱 비밀번호 입력
   - 배포 재시작

#### 문제: "Less secure app access" 관련 에러

**해결 방법:**

- Google은 더 이상 "보안 수준이 낮은 앱 액세스"를 지원하지 않습니다
- 반드시 **앱 비밀번호**를 사용해야 합니다
- 일반 비밀번호로는 작동하지 않습니다

#### 문제: 이메일이 발송되지 않음

**해결 방법:**

1. **Vercel 로그 확인**
   - Vercel 대시보드 → 프로젝트 → Deployments → 최신 배포 → Logs
   - "이메일 전송 오류" 또는 관련 에러 메시지 확인

2. **환경 변수 확인**
   - 모든 환경 변수가 Production 환경에 설정되어 있는지 확인
   - 변수명의 대소문자가 정확한지 확인 (예: `SMTP_HOST`가 아닌 `smtp_host`로 되어있지 않은지)

3. **일일 발송 제한 확인**
   - Gmail 개인 계정은 하루 약 500통 제한
   - 제한을 초과하면 일시적으로 차단될 수 있음
   - 24시간 후 다시 시도

#### 문제: "Connection timeout" 또는 "ECONNREFUSED" 에러

**해결 방법:**

1. **포트 번호 확인**
   - `SMTP_PORT`가 `587`로 설정되어 있는지 확인
   - 방화벽이나 네트워크에서 포트 587이 차단되지 않았는지 확인

2. **SMTP 호스트 확인**
   - `SMTP_HOST`가 정확히 `smtp.gmail.com`으로 설정되어 있는지 확인
   - 오타가 없는지 확인 (예: `smtp.gmail.co` 같은 오타)

#### 문제: 이메일이 스팸함으로 이동

**해결 방법:**

1. **발신자 정보 확인**
   - `SMTP_FROM_NAME`을 명확하고 신뢰할 수 있는 이름으로 설정
   - 예: `피지컬 AI 교육`, `Physical AI Academy` 등

2. **이메일 내용 최적화**
   - 스팸 키워드 (광고, 할인, 무료 등) 사용 최소화
   - HTML 형식의 이메일 템플릿 사용

3. **도메인 인증 (선택사항)**
   - 자체 도메인을 사용하는 경우 SPF, DKIM, DMARC 레코드 설정
   - Gmail을 통한 발송은 Google 도메인을 사용하므로 제한적

#### 문제: 앱 비밀번호 페이지에 접근할 수 없음

**해결 방법:**

1. **2단계 인증 필수**
   - 앱 비밀번호는 2단계 인증이 활성화된 계정에서만 생성 가능
   - 먼저 2단계 인증을 활성화한 후 앱 비밀번호 페이지 접속

2. **Google Workspace 계정**
   - Google Workspace(구 G Suite) 계정인 경우
   - 관리자가 앱 비밀번호 생성을 허용해야 할 수 있음
   - 관리자에게 문의

3. **계정 타입 확인**
   - 개인 Gmail 계정만 앱 비밀번호 생성 가능
   - 일부 기업 계정은 제한이 있을 수 있음

### 이메일이 스팸함으로 이동하는 경우

- 발신자 이메일 주소를 신뢰할 수 있는 도메인으로 변경
- SPF, DKIM, DMARC 레코드 설정 (도메인 이메일 사용 시)
- 이메일 내용에 스팸 키워드 제거

## 보안 주의사항

1. **앱 비밀번호 사용 권장**
   - Gmail 등은 앱 비밀번호 사용 권장
   - 일반 비밀번호 사용 시 보안 위험

2. **환경 변수 보안**
   - 환경 변수는 절대 코드에 하드코딩하지 마세요
   - Vercel 환경 변수에만 저장하세요

3. **이메일 주소 검증**
   - 현재는 기본적인 형식 검증만 수행
   - 필요시 더 엄격한 검증 추가 가능

## 참고 자료

- [Nodemailer 문서](https://nodemailer.com/)
- [Gmail 앱 비밀번호](https://support.google.com/accounts/answer/185833)
- [Vercel 환경 변수 설정](https://vercel.com/docs/concepts/projects/environment-variables)






